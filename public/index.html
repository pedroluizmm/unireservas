<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>UniReservas</title>
<style>
  body { font-family: Arial, sans-serif; margin: 20px; }
  .tabs { display: flex; margin-bottom: 10px; }
  .tab { margin-right: 10px; padding: 5px 10px; border: 1px solid #ccc; cursor: pointer; }
  .active { background: #eee; }
  .content { display: none; }
  .show { display: block; }
  label { display: block; margin: 5px 0; }
</style>
</head>
<body>
<div class="tabs">
  <div id="userTab" class="tab active">Usuário</div>
  <div id="adminTab" class="tab">Admin</div>
</div>
<div id="userContent" class="content show">
  <h2>Fazer Reserva</h2>
  <label>Cliente ID: <input id="clienteId" /></label>
  <label>Restaurante: <select id="restauranteSelect"></select></label>
  <label>Horário: <input id="horario" placeholder="18:00" /></label>
  <label>Número de Pessoas: <input id="numPessoas" type="number" min="1" value="1" /></label>
  <label>Localização:
    <select id="localizacao">
      <option value="externa">Externa</option>
      <option value="interna">Interna</option>
    </select>
  </label>
  <label>Cartão: <input id="cartao" /></label>
  <div id="valor">Valor Total: R$0.00</div>
  <button id="reservarBtn">Reservar</button>
  <div id="msg"></div>
</div>
<div id="adminContent" class="content">
  <h2>Restaurantes</h2>
  <ul id="listaRestaurantes"></ul>
  <h2>Mesas</h2>
  <ul id="listaMesas"></ul>
</div>
<script>
const userTab = document.getElementById('userTab');
const adminTab = document.getElementById('adminTab');
const userContent = document.getElementById('userContent');
const adminContent = document.getElementById('adminContent');
userTab.onclick = () => { userTab.classList.add('active'); adminTab.classList.remove('active'); userContent.classList.add('show'); adminContent.classList.remove('show'); };
adminTab.onclick = () => { adminTab.classList.add('active'); userTab.classList.remove('active'); adminContent.classList.add('show'); userContent.classList.remove('show'); };
async function carregarRestaurantes() {
  const res = await fetch('/api/restaurantes');
  const restaurantes = await res.json();
  const select = document.getElementById('restauranteSelect');
  const list = document.getElementById('listaRestaurantes');
  select.innerHTML = '';
  list.innerHTML = '';
  restaurantes.forEach(r => {
    const opt = document.createElement('option');
    opt.value = r.id_restaurante;
    opt.textContent = r.nome;
    select.appendChild(opt);
    const li = document.createElement('li');
    li.textContent = r.nome + ' - ' + r.endereco;
    list.appendChild(li);
  });
}
async function carregarMesas() {
  const res = await fetch('/api/mesas');
  const mesas = await res.json();
  const list = document.getElementById('listaMesas');
  list.innerHTML = '';
  mesas.forEach(m => {
    const li = document.createElement('li');
    li.textContent = 'Mesa ' + m.id_mesa + ' - Cap ' + m.capacidade + ' - ' + m.localizacao;
    list.appendChild(li);
  });
}
carregarRestaurantes();
carregarMesas();
const numInput = document.getElementById('numPessoas');
const locSelect = document.getElementById('localizacao');
numInput.oninput = calcularValor;
locSelect.onchange = calcularValor;
function calcularValor() {
  const num = parseInt(numInput.value) || 0;
  let valor = num * 50;
  if (num > 6) valor *= 1.1;
  if (locSelect.value === 'interna') valor *= 1.2;
  document.getElementById('valor').textContent = 'Valor Total: R$' + valor.toFixed(2);
  return valor;
}
calcularValor();
document.getElementById('reservarBtn').onclick = async () => {
  const valorTotal = calcularValor();
  const data = {
    clienteId: document.getElementById('clienteId').value,
    restauranteId: document.getElementById('restauranteSelect').value,
    horario: document.getElementById('horario').value,
    numPessoas: parseInt(numInput.value),
    localizacao: locSelect.value,
    valorTotal,
    cartaoNumero: document.getElementById('cartao').value
  };
  const dispRes = await fetch('/api/verificar-disponibilidade', {
    method: 'POST',
    headers: {'Content-Type': 'application/json'},
    body: JSON.stringify({
      restauranteId: data.restauranteId,
      horario: data.horario,
      numPessoas: data.numPessoas,
      localizacao: data.localizacao
    })
  });
  const disp = await dispRes.json();
  if (!disp.disponivel) {
    document.getElementById('msg').textContent = 'Mesa indisponível';
    return;
  }
  const res = await fetch('/api/criar-reserva', {
    method: 'POST',
    headers: {'Content-Type': 'application/json'},
    body: JSON.stringify(data)
  });
  const result = await res.json();
  document.getElementById('msg').textContent = result.sucesso ? 'Reserva criada com sucesso!' : result.mensagem;
};
</script>
</body>
</html>
